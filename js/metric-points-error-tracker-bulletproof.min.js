/**
 * Metric Points Error Tracker - Bulletproof Wrapper v1.0.0
 * Ensures the error tracker never breaks websites
 */
!function(){"use strict";const e={errorHandlerUrl:"https://metricpoints.com/js/metric-points-error-handler.min.js",trackerUrl:"https://metricpoints.com/js/metric-points-error-tracker.min.js",fallbackTimeout:5e3,maxRetries:3};let t=!1,n=!1,r=0;function o(e,t=null){try{window.console&&window.console.log&&console.log("[Metric Points Bulletproof]",e,t)}catch(e){}}function i(e,t=null){try{window.console&&window.console.error&&console.error("[Metric Points Bulletproof]",e,t)}catch(e){}}function a(e,t,n=null){try{const r=document.createElement("script");r.src=e,r.async=!0,r.onload=function(){o("Script loaded successfully",e),t&&t()},r.onerror=function(){i("Failed to load script",e),n&&n()},setTimeout(function(){r.onload||(i("Script load timeout",e),n&&n())},e.fallbackTimeout),document.head.appendChild(r)}catch(e){i("Error creating script element",e),n&&n()}}function s(){if(t)return;o("Loading error handler..."),a(e.errorHandlerUrl,function(){t=!0,o("Error handler loaded successfully"),c()},function(){i("Failed to load error handler, proceeding without it"),c()})}function c(){if(n)return;o("Loading main error tracker..."),a(e.trackerUrl,function(){n=!0,o("Main tracker loaded successfully"),u()},function(){i("Failed to load main tracker"),r<e.maxRetries&&(r++,o("Retrying tracker load...",r),setTimeout(c,1e3*r))})}function u(){try{if(window.MetricPointsConfig)l();else{const e=setInterval(function(){window.MetricPointsConfig&&(clearInterval(e),l())},100);setTimeout(function(){clearInterval(e),i("Configuration timeout - tracker not started")},1e4)}}catch(e){i("Error setting up tracker",e)}}function l(){try{if(!window.MetricPointsTracker)return void i("Tracker not available");if(window.MetricPointsErrorHandler&&window.MetricPointsErrorHandler.safeExecute){const e=window.MetricPointsTracker;e.start&&(e.start=window.MetricPointsErrorHandler.safeExecute(e.start,{type:"tracker_initialization",function:"start",fallback:function(){return i("Tracker start failed, using fallback"),!1}})),e.trackError&&(e.trackError=window.MetricPointsErrorHandler.safeExecute(e.trackError,{type:"error_tracking",function:"trackError",fallback:function(){return i("Error tracking failed"),!1}}))}"function"==typeof e.start?e.start():i("Tracker start method not available")}catch(e){i("Error starting tracker",e)}}function f(){try{window.addEventListener("error",function(e){i("Global error detected",{message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno}),e.preventDefault()}),window.addEventListener("unhandledrejection",function(e){i("Unhandled promise rejection",e.reason),e.preventDefault()}),o("Global error monitoring setup complete")}catch(e){i("Failed to setup global error monitoring",e)}}function d(){try{const e={timestamp:new Date().toISOString(),url:window.location.href,errorHandlerLoaded:t,trackerLoaded:n,loadAttempts:r,config:!!window.MetricPointsConfig,tracker:!!window.MetricPointsTracker,errorHandler:!!window.MetricPointsErrorHandler};return o("Health check completed",e),e}catch(e){return i("Health check failed",e),{error:"Health check failed"}}}window.MetricPointsBulletproof={runHealthCheck:d,getStatus:function(){return{errorHandlerLoaded:t,trackerLoaded:n,loadAttempts:r}},forceReload:function(){t=!1,n=!1,r=0,s()}},f(),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",s):s(),setTimeout(d,2e3),o("Metric Points Bulletproof Wrapper loaded successfully")}();
